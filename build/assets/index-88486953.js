import{a6 as D,dE as P,bN as z,cx as ve,a7 as j,a8 as A,af as te,c7 as he,c8 as me,U as ie,b6 as J,cV as ke,cW as De,cX as Te,aL as B,ar as xe,N as I,aO as we,E as e,aZ as $e,a_ as Ae,cY as Ee,cw as ze,ah as F,c6 as _,al as W,a$ as Oe,V as Le,cB as re,eN as Ve,aI as Be,ao as x,cy as Fe,aQ as O,L as H,c_ as _e,dk as ae,ch as L,ci as V,dl as We,eO as pe,eP as fe,bS as He,bT as Qe,bV as Pe,bW as je,bX as Ne,bZ as qe,ai as X,ax as Ye,x as Je,M as de,ae as ye,b7 as K,c5 as ee,bM as Y,bI as Xe,bO as Ze,ay as Ge,az as Ke,dn as et,dI as tt,dJ as it,cR as st,J as ot,bz as nt,eQ as ce,ca as rt,cb as at,cc as dt,cd as ct,ce as lt,cf as le,cg as ut,a9 as vt}from"./useUserTheme-cad0e91d.js";import{P as ht}from"./index-f93cc2e8.js";const mt=D.memoize(v=>{const{mediaType:i,mediaItem:n,rating:o,content:t}=v,s={id:P(),rating:o?o+1:void 0,content:t,updatedAt:"",createdAt:z(new Date).toISOString()};return{...{mediaType:i,mediaItem:n,reviews:[s]}}}),wt=D.memoize(v=>{const{mediaType:i,mediaItem:n,reviews:o=[],review:t,rating:s,content:d}=v,{id:c}=t||{},l=t?{...t,rating:s?s+1:void 0,content:d,updatedAt:z(new Date).toISOString()}:{id:P(),rating:s?s+1:void 0,content:d,updatedAt:"",createdAt:z(new Date).toISOString()},r=t?o.map(y=>y.id===c?{...l}:{...y}):[...o,l];return{...{mediaType:i,mediaItem:n,reviews:ve([...r]).desc(({updatedAt:y,createdAt:u})=>y||u)}}}),pt=D.memoize(v=>{const{mediaType:i,mediaItem:n,reviews:o=[],review:t}=v,s=o.filter(({id:c})=>c!==t.id);return{...{mediaType:i,mediaItem:n,reviews:ve([...s]).desc(({updatedAt:c,createdAt:l})=>c||l)}}}),ge=D.memoize(({mediaItems:v=[],mediaItem:{id:i},updatedMediaItem:n})=>{const o=[];return v.forEach(t=>{t.mediaItem.id===i?o.push({...n}):o.push({...t})}),[...o]}),ft=D.range(10),q={rating:null,content:""},Re=v=>{const i=j(),{color:n,colorMode:o}=A(),{spacing:t}=te(),s=he(),{isOpen:d,onOpen:c,onClose:l}=me(),{mediaType:r,mediaItem:h,renderButton:y,review:u}=v,{id:R}=u||{},b=ie(),{id:C,reviews:{user:w}}=J(m=>m.users.data.activeUser.data),{control:k,setValue:M,reset:S,handleSubmit:E}=ke({defaultValues:q}),a=De({control:k}),{isDirty:p}=Te({control:k}),f=B(`ds-edb-view-reviews-create-edit-review-${R||P()}-success-toast`),Q=B(`ds-edb-view-reviews-create-edit-review-${R||P()}-error-toast`),Z=()=>{b(ae({...We})),l()},N=()=>{p?b(ae({isOpen:!0,title:"Unsubmitted Changes!",subtitle:`Are you sure you want to cancel ${u?"editing":"creating"} the review? Once you close the page you will not be able to retrieve the changed data!`,onConfirm:()=>Z()})):l()},Ie=()=>{M("rating",q.rating,{shouldDirty:!0}),M("content",q.content,{shouldDirty:!0})},se=m=>{const{title:U=`the ${x({type:"single",mediaType:"movie"})}`}=h;b(pe({id:C,data:[...m]})),s.isActive(f)||s({id:f,duration:L(),position:"bottom-left",render:()=>e(V,{duration:12.5,description:`Successfully ${u?"edited the":"created a"} review for ${U}!`,status:"success",onClose:()=>s.close(f)})}),l()},oe=m=>{const{name:U=`the ${x({type:"single",mediaType:"tv"})}`}=h;b(fe({id:C,data:[...m]})),s.isActive(f)||s({id:f,duration:L(),position:"bottom-left",render:()=>e(V,{duration:12.5,description:`Successfully ${u?"edited the":"created a"} review for ${U}!`,status:"success",onClose:()=>s.close(f)})}),l()},Ce=({rating:m,content:U})=>{const T=w.movie.find(({mediaItem:{id:g}})=>g===h.id),$=w.tv.find(({mediaItem:{id:g}})=>g===h.id);if(T||$){const{reviews:g=[]}=T||{},{reviews:Se=[]}=$||{},Ue=wt({mediaType:r,mediaItem:h,reviews:r==="movie"?g:r==="tv"?Se:[],review:u,rating:m,content:U}),ne=ge({mediaItems:w[r],mediaItem:h,updatedMediaItem:Ue});r==="movie"?se([...ne]):r==="tv"&&oe([...ne])}else if(h){const g=mt({mediaType:r,mediaItem:h,rating:m,content:U});r==="movie"?se([...w.movie,g]):r==="tv"&&oe([...w.tv,g])}else s.isActive(Q)||s({id:Q,duration:L(),position:"bottom-left",render:()=>e(V,{duration:12.5,description:`Unfortunately, something went wrong when trying to ${u?"edit":"create"} the review.`,status:"error",onClose:()=>s.close(Q)})})};return xe(()=>{u&&S({rating:u.rating,content:u.content})},[d]),I(we,{children:[y({color:n,colorMode:o,icon:u?"edit":"add_circle",category:d?"filled":"outlined",onClick:()=>c()}),e($e,{colorMode:o,isOpen:d,onClose:N,size:"2xl",children:I(Ae,{as:Ee,onSubmit:E(Ce),children:[e(ze,{renderTitle:m=>e(F,{...m,children:u?"Edit Review":"Create a new review"}),renderSubtitle:m=>e(F,{...m,children:u?"Edit an existing review by updating the rating & updating the content of the review":"Create a new review by giving a rating from 0 to 10 & entering the content outlining the review"}),renderCancel:({icon:m,category:U,...T})=>e(_,{...T,children:e(W,{icon:m,category:U})})}),e(Oe,{children:I(Le,{width:"100%",spacing:t,children:[e(re,{control:k,name:"rating",render:({field:{onBlur:m,value:U,name:T},fieldState:{error:$}})=>e(Ve,{color:"yellow",colorMode:o,label:"Rating",name:T,helper:$?$.message:void 0,isError:D.isBoolean($),isFullWidth:!0,onBlur:m,onChange:({rating:g})=>M(T,g,{shouldDirty:!0}),value:ft.filter(g=>g<=(U||-1))})}),e(re,{control:k,name:"content",render:({field:{onChange:m,onBlur:U,value:T,name:$},fieldState:{error:g}})=>e(Be,{color:n,colorMode:o,label:"Content",name:$,helper:g?g.message:void 0,placeholder:`Try "This ${x({type:"single",mediaType:r})} was ..."`,isError:D.isBoolean(g),isFullWidth:!0,isRequired:!0,onBlur:U,onChange:m,value:T,sx:{textarea:{height:i.space[12.5]}}})})]})}),e(Fe,{renderCancel:m=>e(O,{...m,children:"Cancel"}),renderAction:m=>I(H,{children:[e(_e,{in:p||!D.isEqual(q,a),children:e(O,{...m,color:n,onClick:Ie,variant:"text",children:"Clear"})}),e(O,{...m,color:n,isDisabled:!p,type:"submit",children:u?"Edit Review":"Submit Review"})]})})]})})]})},kt=v=>{const{color:i,colorMode:n}=A(),{mediaType:o,mediaItem:t,name:s,...d}=v;return e(He,{...d,color:i,colorMode:n,children:I(Qe,{children:[I(Pe,{children:[e(je,{children:s?`You currently have not written any reviews for "${s}"`:`You currently have not written any reviews for the ${x({type:"single",mediaType:o})}`}),e(Ne,{children:s?`Leave your taughts about "${s}" to help others make up their mind.`:`Leave your taughts about the ${x({type:"single",mediaType:o})} to help others make up their mind.`})]}),e(qe,{renderActions:c=>e(Re,{mediaType:o,mediaItem:t,renderButton:({icon:l,category:r,...h})=>e(O,{...c,...h,renderLeft:({color:y,colorMode:u,height:R})=>e(X,{width:`${R}px`,height:`${R}px`,fontSize:`${R}px`,colorMode:u,icon:l,category:r,skeletonColor:y}),children:"Create a new Review"})})})]})})},{convertREMToPixels:yt,convertStringToNumber:gt,getColor:ue}=ye,G=.75,be=v=>{const i=j(),{colorMode:n}=A(),[o,{width:t}]=Ye(),{renderIcon:s,renderLabel:d,...c}=v,l=Je.useCallback(()=>{const r=yt(gt(i.space[G],"rem"));return`calc(100% - ${t+r}px)`},[i,t,G]);return I(H,{...c,spacing:G,children:[e(de,{ref:o,children:s({width:i.fontSizes.sm,height:i.fontSizes.sm,fontSize:i.fontSizes.sm,colorMode:n,color:ue({theme:i,colorMode:n,type:"text.secondary"})})}),e(de,{maxWidth:l(),alignItems:"center",justifyContent:"flex-start",children:d({align:"left",color:ue({theme:i,colorMode:n,type:"text.secondary"}),fontSize:["xs","xs","sm","sm","sm","sm"],lineHeight:"shorter",whiteSpace:"nowrap"})})]})},Rt=({username:v})=>e(be,{renderIcon:i=>e(X,{...i,icon:"alternate_email",category:"outlined"}),renderLabel:i=>e(F,{...i,children:v})}),bt=({createdAt:v})=>{const{colorMode:i}=A(),[n,o]=K();return e(ee,{"aria-label":"Show full created at date (tooltip)",colorMode:i,isOpen:n,placement:"bottom-start",label:`Posted on: ${Y({date:v})}`,shouldWrapChildren:!0,children:e(be,{renderIcon:t=>e(X,{...t,icon:"schedule",category:"outlined"}),renderLabel:t=>e(F,{...t,children:Y({date:v,section:"year"})}),onMouseEnter:()=>o.on(),onMouseLeave:()=>o.off()})})},{getColor:Mt,getHue:It}=ye,Me=v=>{const i=j(),{colorMode:n}=A(),{renderFooterActions:o,name:t,username:s,avatar_path:d,created_at:c,updated_at:l,rating:r,content:h}=v,y=B(t?`${t} ${x({type:"single",mediaType:"person"})} avatar`:`${x({type:"single",mediaType:"person"})} avatar`),u=B(P());return I(Xe,{colorMode:n,isFullWidth:!0,p:2,children:[e(Ze,{renderLeft:()=>e(Ge,{width:i.fontSizes["5xl"],height:i.fontSizes["5xl"],borderRadius:"full",ratio:Ke({orientation:"square"}),children:e(et,{alt:y,width:"inherit",height:"inherit",borderRadius:"full",src:{boring:tt({id:s?s.trim():u,colors:D.omit({...i.colors},["transparent","black","white"]),hue:It({colorMode:n,type:"color"}),size:500,variant:it({mediaType:"person"})}),full:d?d.charAt(0)==="/"?d.substring(1):d:void 0}})}),renderTitle:R=>e(F,{...R,children:t}),renderSubtitle:()=>I(H,{children:[!!s&&e(Rt,{username:s}),!!l&&!!c&&e(bt,{createdAt:c})]}),actions:r?e(st,{rating:r,size:"xl"}):void 0,spacing:1.5}),e(ot,{children:e(ht,{variant:"transparent",children:h})}),(c||l||o)&&e(nt,{children:I(H,{width:"100%",alignItems:"center",justifyContent:"space-between",children:[(c||l)&&e(F,{align:"left",color:Mt({theme:i,colorMode:n,type:"text.secondary"}),fontSize:"sm",children:l?`* Updated on: ${Y({date:l})}`:c?`* Posted on: ${Y({date:c})}`:""}),o&&o()]})})]})},Dt=v=>{const{color:i,colorMode:n}=A(),{isGuest:o}=te(),t=ie(),{id:s,reviews:{other:d=[]}}=J(a=>a.users.data.activeUser.data),{review:c}=v,{id:l,author_details:r,author:h,created_at:y,updated_at:u,content:R=""}=c,[b,C]=K(),[w,k]=K(),M=d.some(a=>a.review.id===l&&a.state==="isLiked"),S=d.some(a=>a.review.id===l&&a.state==="isDisliked"),E=a=>{if(M||S){const p=[];d.forEach(f=>{f.review.id===l?p.push({...f,state:a==="isLiked"&&S?"isLiked":a==="isDisliked"&&M?"isDisliked":M||S?null:a,updatedAt:z(new Date).toISOString()}):p.push({...f})}),t(ce({id:s,data:D.uniq([...p])}))}else{const p={state:a,review:c,updatedAt:z(new Date).toISOString(),addedAt:z(new Date).toISOString()};t(ce({id:s,data:[...d,{...p}]}))}};return e(Me,{...r||{},renderFooterActions:o?void 0:()=>I(H,{spacing:0,children:[e(ee,{"aria-label":M?"Unlike review (tooltip)":"Like review (tooltip)",colorMode:n,isOpen:b,placement:"top",label:M?"Unlike":"Like",children:e(_,{"aria-label":M?"Unlike review":"Like review",color:M?i:"gray",colorMode:n,isActive:M,onMouseEnter:()=>C.on(),onMouseLeave:()=>C.off(),onClick:()=>E("isLiked"),size:"xs",variant:"icon",children:e(W,{icon:"thumb_up",category:M?"filled":"outlined"})})}),e(ee,{"aria-label":S?"Un-dislike review (tooltip)":"Dislike review (tooltip)",colorMode:n,isOpen:w,placement:"top",label:S?"Un-dislike":"Dislike",children:e(_,{"aria-label":S?"Un-dislike review":"Dislike review",color:S?i:"gray",colorMode:n,isActive:S,onMouseEnter:()=>k.on(),onMouseLeave:()=>k.off(),onClick:()=>E("isDisliked"),size:"xs",variant:"icon",children:e(W,{icon:"thumb_down",category:S?"filled":"outlined"})})})]}),name:(r==null?void 0:r.name)||h,created_at:y,updated_at:u,content:R})},Ct=v=>{const i=j(),{colorMode:n}=A(),{spacing:o}=te(),t=he(),{isOpen:s,onOpen:d,onClose:c}=me(),{renderButton:l,mediaType:r,mediaItem:h,review:y}=v,{id:u}=y,R=ie(),{id:b,reviews:{user:C}}=J(a=>a.users.data.activeUser.data),w=B(`ds-edb-view-reviews-delete-review-${u}-success-toast`),k=B(`ds-edb-view-reviews-delete-review-${u}-error-toast`),M=a=>{const{title:p=`the ${x({type:"single",mediaType:"movie"})}`}=h;R(pe({id:b,data:[...a]})),t.isActive(w)||t({id:w,duration:L(),position:"bottom-left",render:()=>e(V,{duration:12.5,description:`Successfully deleted the review for ${p}!`,status:"success",onClose:()=>t.close(w)})}),c()},S=a=>{const{name:p=`the ${x({type:"single",mediaType:"tv"})}`}=h;R(fe({id:b,data:[...a]})),t.isActive(w)||t({id:w,duration:L(),position:"bottom-left",render:()=>e(V,{duration:12.5,description:`Successfully deleted the review for ${p}!`,status:"success",onClose:()=>t.close(w)})}),c()},E=()=>{const a=C.movie.find(({mediaItem:{id:f}})=>f===h.id),p=C.tv.find(({mediaItem:{id:f}})=>f===h.id);if(a||p){const{reviews:f=[]}=a||{},{reviews:Q=[]}=p||{},Z=pt({mediaType:r,mediaItem:h,reviews:r==="movie"?f:r==="tv"?Q:[],review:y}),N=ge({mediaItems:C[r],mediaItem:h,updatedMediaItem:Z});r==="movie"?M([...N]):r==="tv"&&S([...N])}else t.isActive(k)||t({id:k,duration:L(),position:"bottom-left",render:()=>e(V,{duration:12.5,description:"Unfortunately, something went wrong when trying to delete the review.",status:"error",onClose:()=>t.close(k)})})};return I(we,{children:[l({color:"red",colorMode:n,icon:"delete_forever",category:s?"filled":"outlined",onClick:()=>d()}),e(rt,{colorMode:n,renderCancel:({icon:a,category:p,...f})=>e(_,{...f,children:e(W,{icon:a,category:p})}),isOpen:s,onClose:c,children:I(at,{spacing:o,p:o,children:[e(dt,{renderIcon:a=>e(X,{...a,width:i.fontSizes["6xl"],height:i.fontSizes["6xl"],fontSize:i.fontSizes["6xl"],icon:"delete_forever",category:"outlined"}),color:"red",p:2}),I(ct,{children:[e(lt,{children:"Delete Review?"}),e(le,{children:"Are you sure you want to delete the selected review?"}),e(le,{children:"This action is irreversible!"})]}),e(ut,{renderCancel:a=>e(O,{...a,children:"Cancel"}),renderAction:a=>e(O,{...a,color:"red",isDisabled:!u,onClick:E,children:"Delete"})})]})})]})},Tt=v=>{const i=j(),{colorMode:n}=A(),[o]=vt(`(max-width: ${i.breakpoints.sm})`),{mediaType:t,mediaItem:s,review:d}=v,{rating:c,createdAt:l,updatedAt:r,content:h=""}=d,{info:{name:y,avatar_path:u},credentials:{username:R}}=J(b=>b.users.data.activeUser.data);return e(Me,{renderFooterActions:()=>I(H,{spacing:0,children:[e(Re,{mediaType:t,mediaItem:s,renderButton:({icon:b,category:C,...w})=>e(_,{...w,color:"gray",colorMode:n,isFullWidth:!0,size:o?"xs":"sm",variant:"icon",children:e(W,{icon:b,category:C})}),review:d}),e(Ct,{mediaType:t,mediaItem:s,renderButton:({icon:b,category:C,...w})=>e(_,{...w,color:"gray",colorMode:n,isFullWidth:!0,size:o?"xs":"sm",variant:"icon",children:e(W,{icon:b,category:C})}),review:d})]}),name:y,username:R,avatar_path:u,rating:c,created_at:l,updated_at:r,content:h})};export{Tt as V,Dt as a,kt as b,Re as c};
